<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Entorno 3D VR</title>
  <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
</head>
<body>
  <a-scene vr-mode-ui="enabled: true">
    <!-- Suelo -->
    <a-entity geometry="primitive: plane; width: 100; height: 100" material="color: green" rotation="-90 0 0" position="0 0 0"></a-entity>

    <!-- Paredes -->
    <a-entity geometry="primitive: plane; width: 100; height: 20" material="color: blue" position="0 10 -50"></a-entity>
    <a-entity geometry="primitive: plane; width: 100; height: 20" material="color: hotpink" position="0 10 50" rotation="0 180 0"></a-entity>
    <a-entity geometry="primitive: plane; width: 100; height: 20" material="color: yellow" position="-50 10 0" rotation="0 90 0"></a-entity>
    <a-entity geometry="primitive: plane; width: 100; height: 20" material="color: orange" position="50 10 0" rotation="0 -90 0"></a-entity>
    <a-entity geometry="primitive: plane; width: 100; height: 100" material="color: gray" rotation="90 0 0" position="0 20 0"></a-entity>

    <!-- Cámara con movimiento y controles de VR -->
    <a-entity id="camera" camera look-controls wasd-controls position="0 1.8 0">
      <a-entity cursor="fuse: true; fuseTimeout: 500"
                position="0 0 -1"
                geometry="primitive: ring; radiusInner: 0.02; radiusOuter: 0.03"
                material="color: white; shader: flat">
      </a-entity>
    </a-entity>

    <!-- Controles de VR para Meta Quest 3 -->
    <a-entity id="leftController" tracked-controls="hand: left"></a-entity>
    <a-entity id="rightController" tracked-controls="hand: right"></a-entity>
    <a-entity hand-tracking-controls></a-entity>

    <!-- Obstáculos -->
    <a-entity geometry="primitive: box; width: 2; height: 2; depth: 2" material="color: red" position="0 1 10"></a-entity>
    <a-entity geometry="primitive: box; width: 2; height: 2; depth: 2" material="color: purple" position="-10 1 -10"></a-entity>
  </a-scene>

  <script>
    // Obtén la cámara
    const camera = document.querySelector('#camera');

    // Velocidad de movimiento (ajustada para que sea más rápida)
    const speed = 0.2;

    // Función para mover la cámara con los joysticks del mando de Quest 3
    AFRAME.registerComponent('joystick-movement', {
      init: function () {
        this.el.addEventListener('thumbstickmoved', (event) => {
          const position = this.el.getAttribute('position');
          position.x += event.detail.x * speed;
          position.z -= event.detail.y * speed; // Invertir el eje Y para que coincida con la dirección del joystick
          this.el.setAttribute('position', position);
        });
      }
    });

    // Aplicar el componente de movimiento al control derecho
    document.querySelector('#rightController').setAttribute('joystick-movement', '');

    // Función para mover la cámara con las teclas de flecha
    function setupMovement() {
      window.addEventListener('keydown', (event) => {
        const position = camera.getAttribute('position');

        switch (event.key) {
          case 'ArrowUp':    // Flecha arriba
            position.z -= speed;
            break;
          case 'ArrowDown':  // Flecha abajo
            position.z += speed;
            break;
          case 'ArrowLeft':  // Flecha izquierda
            position.x -= speed;
            break;
          case 'ArrowRight': // Flecha derecha
            position.x += speed;
            break;
        }

        // Actualiza la posición de la cámara
        camera.setAttribute('position', position);
      });
    }

    // Función para generar obstáculos aleatorios
    function generateObstacles(numObstacles) {
      const scene = document.querySelector('a-scene');
      for (let i = 0; i < numObstacles; i++) {
        const obstacle = document.createElement('a-entity');
        obstacle.setAttribute('geometry', {
          primitive: 'box',
          width: 2,
          height: 2,
          depth: 2,
        });
        obstacle.setAttribute('material', {
          color: '#FF0000',
        });
        const x = (Math.random() - 0.5) * 80;
        const z = (Math.random() - 0.5) * 80;
        obstacle.setAttribute('position', { x, y: 1, z });
        scene.appendChild(obstacle);
      }
    }

    // Configura el movimiento con las teclas de flecha
    setupMovement();

    // Genera 10 obstáculos aleatorios
    generateObstacles(10);
  </script>
</body>
</html>
